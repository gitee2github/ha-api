webpackJsonp([1],{1379:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function l(e){var t=!0,a=!1;switch(e.status){case"Master":break;case"Master/Standby":a=!0;break;case"Not Running/Standby":t=!1,a=!0;break;case"Standby":a=!0;break;case"Not Running":t=!1;break;case"Running":t=!0}e.running=t,e.standby=a}function r(e){if(e.drbdStatus&&"0"!==e.drbdStatus)return"error";switch(e.status){case"Running":return"success";case"Not Running":return e.status_message?"error":"default";case"Unmanaged":return"warning";case"Failed":case"Stop Failed":return"error";case"running(Master)":case"running(Slave)":return e.status="Running","success";default:return"default"}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(611),o=n(i),s=a(1385),c=n(s),d=a(191),u=n(d),f=a(72),p=n(f),m=a(192),y=n(m),h=a(609),g=n(h),b=a(10),v=n(b),k=a(121),E=n(k),R=a(24),w=n(R),C=a(120),N=n(C),x=a(73),S=n(x),_=a(30),O=n(_),V=a(5),I=n(V),T=a(8),F=n(T),M=a(6),L=n(M),q=a(7),P=n(q);a(612),a(1386),a(289),a(82),a(290),a(610),a(151),a(103),a(74);var B=a(0),j=n(B),K=a(4),A=n(K),D=a(9),H=n(D),z=a(28),W=a(75),J=a(27),U=a(1387),X=n(U),G=function(e){function t(){return(0,I.default)(this,t),(0,L.default)(this,(t.__proto__||(0,O.default)(t)).apply(this,arguments))}return(0,P.default)(t,e),(0,F.default)(t,[{key:"componentDidUpdate",value:function(e){var t=this.props.mainLockVisible;!e.mainLockVisible&&t&&this.showMainLockView()}},{key:"handleRowClick",value:function(e){(0,this.props.dispatch)({type:"resource/updateState",payload:{selectedRowKeys:[e.key],selectedRows:[e]}})}},{key:"handleResourceOperation",value:function(e,t){(0,J.handleOperation)(this.props.dispatch,"resource",e,t)}},{key:"handleReFresh",value:function(){var e=this.props.dispatch;e({type:"resource/query"}),e({type:"node/query"}),e({type:"cluster/queryHeartBeatStatus"})}},{key:"showMainLockView",value:function(){var e=this.props,t=e.dispatch,a=e.autoReFreshId,n=e.autoReFreshTaskId;"0"!==a&&(clearInterval(n),t({type:"app/updateState",payload:{autoReFreshTaskId:0}})),S.default.warning({title:"\u96c6\u7fa4\u5904\u4e8e\u672a\u542f\u52a8\u72b6\u6001\u3002",content:j.default.createElement("div",null,j.default.createElement("p",null,"\u8bf7\u542f\u52a8\u96c6\u7fa4\u540e\u7ee7\u7eed\u64cd\u4f5c\u3002")),okText:"\u542f\u52a8",onOk:function(){return new N.default(function(e){t({type:"node/operateLocal",payload:{action:"start"}}).then(function(){setTimeout(function(){return window.location="/resource",e},2e4)})})}})}},{key:"render",value:function(){var e=this,t=this.props,a=t.rsclist,n=t.nodelist,i=t.selectedRowKeys,s=t.selectedRows,d=t.rightSiderFold,f=t.rightSiderNodeId,m=t.dispatch,h=t.loading,b=t.rscOperateLoading,k=t.tableHeight,R=[{title:"\u8d44\u6e90\u540d",dataIndex:"id",key:"id",sorter:function(e,t){return(0,J.strcmp)(e.id,t.id)}},{title:"\u72b6\u6001",dataIndex:"status",key:"status",sorter:function(e,t){return(0,J.strcmp)(e.status,t.status)},width:"10%",render:function(e,t){var a=t.status_message&&"Not Running"===e?"Failed":e,n=void 0;return t.drbdStatus&&"0"!==t.drbdStatus&&(a=t.drbdMsg),"success"===r(t)?n=j.default.createElement("span",{className:"iconfont icon-B",style:{color:"green"}}):"warning"===r(t)?n=j.default.createElement("span",{className:"iconfont icon-B",style:{color:"gold"}}):"default"===r(t)?n=j.default.createElement("span",{className:"iconfont icon-B",style:{color:"#999"}}):"error"===r(t)&&(n=t.drbdStatus&&"0"!==t.drbdStatus?j.default.createElement("span",{className:X.default.redTwinkling},j.default.createElement("i",{className:"iconfont icon-B"})):j.default.createElement("span",{className:"iconfont icon-B",style:{color:"red"}})),j.default.createElement(E.default,{placement:"right",title:a},j.default.createElement("span",{style:{marginLeft:"10%",color:"green"}},b&&s[0].id===t.id?j.default.createElement(w.default,{type:"loading",className:X.default.statusLoading}):n))}},{title:"\u8d44\u6e90\u7c7b\u578b",dataIndex:"type",key:"type",width:"15%",sorter:function(e,t){return(0,J.strcmp)(e.type,t.type)}},{title:"\u670d\u52a1",dataIndex:"svc",key:"svc",width:"15%",sorter:function(e,t){return(0,J.strcmp)(e.svc||"",t.svc||"")}}];n.forEach(function(e){l(e),R.push({title:j.default.createElement("a",{onClick:function(){return m({type:"resource/updateState",payload:{rightSiderFold:!1,rightSiderNodeId:e.id}})}},j.default.createElement(E.default,{placement:"top",title:e.status},j.default.createElement(g.default,{dot:e.standby,style:{backgroundColor:"orange"}},j.default.createElement("span",{className:"iconfont icon-host",style:(0,v.default)({color:"#fff"},"color",e.running?"green":"red")}))),j.default.createElement("span",{className:e.id!==f||d?"":X.default.selectedNode},"\xa0",e.id)),dataIndex:"running_node",key:e.id,width:36/n.length+"%",render:function(t,a){var n=(0,J.queryArray)(a.location,e.id,"node")||{},l=-1===t.indexOf(e.id)?"default":"success",r="success"===l?j.default.createElement("span",null,j.default.createElement("i",{className:"iconfont icon-B",style:{color:"green"}}),j.default.createElement("span",{style:{color:"green"}},n.level)):j.default.createElement("span",null,j.default.createElement("i",{className:"iconfont icon-B",style:{color:"#999"}}),j.default.createElement("span",null,n.level));return j.default.createElement("span",{style:{marginLeft:"10%"}},r)}})});var C={selectedRowKeys:i,onChange:function(e,t){m({type:"resource/updateState",payload:{selectedRowKeys:e,selectedRows:t}})},type:"radio"},N=j.default.createElement(y.default,{onClick:function(e){m({type:"resource/updateState",payload:{detailModalVisible:!0,metaAttrs:{},rsc:{category:e.key}}}),"primitive"===e.key&&m({type:"resource/queryRscTypes"}),m({type:"resource/queryRscAttrs",payload:{category:e.key}})}},j.default.createElement(y.default.Item,{key:"primitive"},"\u6dfb\u52a0\u666e\u901a\u8d44\u6e90"),j.default.createElement(y.default.Item,{key:"group"},"\u6dfb\u52a0\u7ec4\u8d44\u6e90"),j.default.createElement(y.default.Item,{key:"clone"},"\u6dfb\u52a0\u514b\u9686\u8d44\u6e90")),x=j.default.createElement(y.default,{onClick:function(e){m("location"===e.key?{type:"node/query"}:{type:"resource/query"}),m({type:"resource/queryRscRestriction",payload:{id:s[0].id,relation:e.key}}).then(function(){m({type:"resource/updateState",payload:{rscRestrictionModalVisible:!0,rscRestrictionModalTitle:e.key}})})}},j.default.createElement(y.default.Item,{key:"location"},"\u8d44\u6e90\u4f4d\u7f6e"),j.default.createElement(y.default.Item,{key:"colocation"},"\u8d44\u6e90\u534f\u540c"),j.default.createElement(y.default.Item,{key:"order"},"\u8d44\u6e90\u987a\u5e8f")),S=[{onClick:function(){"primitive"===s[0].type&&m({type:"resource/queryRscTypes"}),m({type:"resource/queryRscAttrs",payload:{category:s[0].type}}),m({type:"resource/detail",payload:{id:s[0].id.split(":")[0],category:s[0].type}}).then(function(){m({type:"resource/updateState",payload:{detailModalVisible:!0}})})},icon:"iconfont icon-bianji2",text:"\u7f16\u8f91",enabled:function(){return 1===i.length&&"ms-drbd"!==s[0].id&&"drbd-ps:0"!==s[0].id&&"drbd-ps:1"!==s[0].id}},{onClick:function(){return e.handleResourceOperation(s[0].id,"start")},icon:"iconfont icon-kaishi",text:"\u542f\u52a8",enabled:function(){var e=s;return 1===e.length&&"Running"!==e[0].status}},{onClick:function(){return e.handleResourceOperation(s[0].id,"stop")},icon:"iconfont icon-tingzhi1",text:"\u505c\u6b62",enabled:function(){return 1===s.length}},{onClick:function(){return e.handleResourceOperation(s[0].id,"cleanup")},icon:"iconfont icon-yijianqingli",text:"\u6e05\u7406",enabled:function(){return 1===i.length}},{onClick:function(){m({type:"resource/updateState",payload:{rscMigrationModalVisible:!0}})},icon:"iconfont icon-qianchu",text:"\u8fc1\u79fb",enabled:function(){var e=s;return 1===e.length&&"Running"===e[0].status&&"clone"!==e[0].type&&!e[0].isChild}},{onClick:function(){return e.handleResourceOperation(s[0].id,"unmigrate",{is_all_rscs:!1})},icon:"iconfont icon-qianru",text:"\u56de\u8fc1",enabled:function(){var e=s;return 1===e.length&&"Running"===e[0].status&&"clone"!==e[0].type&&!e[0].isChild&&e[0].allow_unmigrate}}];return j.default.createElement("div",{className:(0,H.default)(X.default.container,(0,v.default)({},X.default.diminish,!d&&document.body.clientWidth>425))},j.default.createElement(W.Loader,{spinning:h}),j.default.createElement("div",{style:{backgroundColor:"#fff",padding:"15px 15px 5px 15px",borderBottom:"1px solid #e4e4e4"}},j.default.createElement(p.default.Group,{className:X.default.btn_group},j.default.createElement(u.default,{overlay:N},j.default.createElement(p.default,{className:X.default.operations},j.default.createElement("span",{className:"iconfont icon-icon-test"}),"\u6dfb\u52a0...")),S.map(function(e){return j.default.createElement(p.default,{key:e.text,className:X.default.operations,disabled:!e.enabled(),onClick:e.onClick,title:e.text},j.default.createElement("span",{className:e.icon}),e.text)}),j.default.createElement(c.default,{placement:"bottom",onConfirm:function(){e.handleResourceOperation(s[0].id,"delete")},title:"\u786e\u8ba4\u5220\u9664\u8d44\u6e90?"},j.default.createElement(p.default,{disabled:!(1===i.length&&!s[0].isChild),title:"\u5220\u9664",className:X.default.operations},j.default.createElement("span",{className:"iconfont icon-shanchukai"}),"\u5220\u9664")),j.default.createElement(u.default,{disabled:!(1===i.length&&"clone"!==s[0].type&&!s[0].isChild&&"ms-drbd"!==s[0].id),overlay:x},j.default.createElement(p.default,{className:X.default.operations},j.default.createElement("span",{className:"iconfont icon-guanxitu"}),"\u5173\u7cfb..")),j.default.createElement(p.default,{title:"\u5237\u65b0",className:(0,H.default)(X.default.operations),style:{float:document.body.clientWidth>1250?"right":void 0,marginRight:0},onClick:this.handleReFresh.bind(this)},j.default.createElement("span",{className:"iconfont icon-shuaxin"}),"\u5237\u65b0"))),j.default.createElement(o.default,{columns:R,rowSelection:C,dataSource:a,scroll:{y:k},pagination:!1,onRow:function(t){return{onClick:function(){return e.handleRowClick(t)}}},locale:{emptyText:"\u6682\u65e0\u6570\u636e"}}),j.default.createElement("div",{className:(0,H.default)(X.default.rightSider,(0,v.default)({},X.default.rightSiderFold,d))},j.default.createElement("div",{className:X.default.button,onClick:function(){return m({type:"resource/updateState",payload:{rightSiderFold:!0}})}},j.default.createElement(w.default,{type:"right"})),j.default.createElement(W.NodeView,null)),j.default.createElement(W.RscDetailModal,null),j.default.createElement(W.RscMigrationModal,null),j.default.createElement(W.RscRestrictions,null))}}]),t}(j.default.PureComponent);G.propTypes={dispatch:A.default.func,rsclist:A.default.array,nodelist:A.default.array,selectedRowKeys:A.default.array,selectedRows:A.default.array,rightSiderFold:A.default.bool,loading:A.default.bool,rscOperateLoading:A.default.bool,tableHeight:A.default.number,mainLockVisible:A.default.bool};var Q=function(e){var t=e.resource,a=e.node,n=e.loading,l=e.app;return{rsclist:t.list,nodelist:a.list,selectedRowKeys:t.selectedRowKeys,selectedRows:t.selectedRows,rightSiderFold:t.rightSiderFold,rightSiderNodeId:t.rightSiderNodeId,loading:n.effects["resource/firstQuery"],rscOperateLoading:n.effects["resource/operate"],tableHeight:document.body.clientHeight-200,mainLockVisible:t.mainLockVisible,autoReFreshId:l.autoReFreshId,autoReFreshTaskId:l.autoReFreshTaskId}};t.default=(0,z.connect)(Q)(G),e.exports=t.default},1385:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=a(3),r=n(l),i=a(5),o=n(i),s=a(8),c=n(s),d=a(6),u=n(d),f=a(7),p=n(f),m=a(0),y=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(m),h=a(121),g=n(h),b=a(24),v=n(b),k=a(72),E=n(k),R=a(122),w=n(R),C=a(150),N=n(C),x=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var l=0,n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&(a[n[l]]=e[n[l]]);return a},S=function(e){function t(e){(0,o.default)(this,t);var a=(0,u.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.onConfirm=function(e){a.setVisible(!1);var t=a.props.onConfirm;t&&t.call(a,e)},a.onCancel=function(e){a.setVisible(!1);var t=a.props.onCancel;t&&t.call(a,e)},a.onVisibleChange=function(e){a.setVisible(e)},a.saveTooltip=function(e){a.tooltip=e},a.renderOverlay=function(e){var t=a.props,n=t.prefixCls,l=t.title,r=t.cancelText,i=t.okText,o=t.okType;return y.createElement("div",null,y.createElement("div",{className:n+"-inner-content"},y.createElement("div",{className:n+"-message"},y.createElement(v.default,{type:"exclamation-circle"}),y.createElement("div",{className:n+"-message-title"},l)),y.createElement("div",{className:n+"-buttons"},y.createElement(E.default,{onClick:a.onCancel,size:"small"},r||e.cancelText),y.createElement(E.default,{onClick:a.onConfirm,type:o,size:"small"},i||e.okText))))},a.state={visible:e.visible},a}return(0,p.default)(t,e),(0,c.default)(t,[{key:"componentWillReceiveProps",value:function(e){"visible"in e&&this.setState({visible:e.visible})}},{key:"getPopupDomNode",value:function(){return this.tooltip.getPopupDomNode()}},{key:"setVisible",value:function(e){var t=this.props;"visible"in t||this.setState({visible:e});var a=t.onVisibleChange;a&&a(e)}},{key:"render",value:function(){var e=this.props,t=e.prefixCls,a=e.placement,n=x(e,["prefixCls","placement"]),l=y.createElement(w.default,{componentName:"Popconfirm",defaultLocale:N.default.Popconfirm},this.renderOverlay);return y.createElement(g.default,(0,r.default)({},n,{prefixCls:t,placement:a,onVisibleChange:this.onVisibleChange,visible:this.state.visible,overlay:l,ref:this.saveTooltip}))}}]),t}(y.Component);t.default=S,S.defaultProps={prefixCls:"ant-popover",transitionName:"zoom-big",placement:"top",trigger:"click",okType:"primary"},e.exports=t.default},1386:function(e,t,a){"use strict";a(16),a(608),a(82)},1387:function(e,t){e.exports={"text-overflow":"_32CXV","icon-button":"_29VBV",redTwinkling:"_3VVet",twinkling:"_2_gpb",rightSider:"bxuXv",button:"n50iD",rightSiderFold:"g2qJx",container:"_2qyLv",diminish:"_2yr1x",selectedNode:"_270Jy",btn_group:"_3fA3W",operations:"_3r3a-"}}});