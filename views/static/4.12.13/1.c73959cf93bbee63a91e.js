webpackJsonp([1],{1377:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function l(e){var t=!0,a=!1;switch(e.status){case"Master":break;case"Master/Standby":a=!0;break;case"Not Running/Standby":t=!1,a=!0;break;case"Standby":a=!0;break;case"Not Running":t=!1;break;case"Running":t=!0}e.running=t,e.standby=a}function r(e){if(e.drbdStatus&&"0"!==e.drbdStatus)return"error";switch(e.status){case"Running":return"success";case"Not Running":return e.status_message?"error":"default";case"Unmanaged":return"warning";case"Failed":case"Stop Failed":return"error";case"running(Master)":case"running(Slave)":return e.status="Running","success";default:return"default"}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(609),o=n(i),s=a(1383),u=n(s),d=a(191),c=n(d),f=a(72),p=n(f),y=a(10),m=n(y),h=a(192),g=n(h),v=a(1384),b=n(v),k=a(121),E=n(k),R=a(607),C=n(R),x=a(22),S=n(x),w=a(120),_=n(w),O=a(73),I=n(O),N=a(30),M=n(N),V=a(5),T=n(V),P=a(8),F=n(P),L=a(6),j=n(L),q=a(7),D=n(q);a(610),a(1385),a(291),a(82),a(292),a(1386),a(151),a(608),a(83),a(74);var z=a(0),K=n(z),W=a(4),H=n(W),A=a(9),B=n(A),J=a(28),U=a(75),X=a(27),G=a(1388),Q=n(G),Z=function(e){function t(){return(0,T.default)(this,t),(0,j.default)(this,(t.__proto__||(0,M.default)(t)).apply(this,arguments))}return(0,D.default)(t,e),(0,F.default)(t,[{key:"componentDidUpdate",value:function(e){var t=this.props.mainLockVisible;!e.mainLockVisible&&t&&this.showMainLockView()}},{key:"handleRowClick",value:function(e){(0,this.props.dispatch)({type:"resource/updateState",payload:{selectedRowKeys:[e.key],selectedRows:[e]}})}},{key:"handleResourceOperation",value:function(e,t){(0,X.handleOperation)(this.props.dispatch,"resource",e,t)}},{key:"handleReFresh",value:function(){var e=this.props.dispatch;e({type:"resource/query"}),e({type:"node/query"}),e({type:"cluster/queryHeartBeatStatus"})}},{key:"showMainLockView",value:function(){var e=this.props,t=e.dispatch,a=e.autoReFreshId,n=e.autoReFreshTaskId;"0"!==a&&(clearInterval(n),t({type:"app/updateState",payload:{autoReFreshTaskId:0}})),I.default.warning({title:"\u96c6\u7fa4\u5904\u4e8e\u672a\u542f\u52a8\u72b6\u6001\u3002",content:K.default.createElement("div",null,K.default.createElement("p",null,"\u8bf7\u542f\u52a8\u96c6\u7fa4\u540e\u7ee7\u7eed\u64cd\u4f5c\u3002")),okText:"\u542f\u52a8",onOk:function(){return new _.default(function(e){t({type:"node/operateLocal",payload:{action:"start"}}).then(function(){setTimeout(function(){return window.location="/resource",e},2e4)})})}})}},{key:"render",value:function(){var e=this,t=this.props,a=t.rsclist,n=t.nodelist,i=t.selectedRowKeys,s=t.selectedRows,d=t.rightSiderFold,f=t.rightSiderNodeId,y=t.dispatch,h=t.loading,v=t.rscOperateLoading,k=t.tableHeight,R=[{title:"\u8d44\u6e90\u540d",dataIndex:"id",key:"id",sorter:function(e,t){return(0,X.strcmp)(e.id,t.id)}},{title:"\u72b6\u6001",dataIndex:"status",key:"status",sorter:function(e,t){return(0,X.strcmp)(e.status,t.status)},width:"10%",render:function(e,t){var a=t.status_message&&"Not Running"===e?"Failed":e;return t.drbdStatus&&"0"!==t.drbdStatus&&(a=t.drbdMsg),K.default.createElement(E.default,{placement:"right",title:a},K.default.createElement("span",{style:{marginLeft:"10%"}},v&&s[0].id===t.id?K.default.createElement(S.default,{type:"loading",className:Q.default.statusLoading}):K.default.createElement(C.default,{className:t.drbdStatus&&"0"!==t.drbdStatus?Q.default.redTwinkling:"",status:r(t)})))}},{title:"\u8d44\u6e90\u7c7b\u578b",dataIndex:"type",key:"type",width:"15%",sorter:function(e,t){return(0,X.strcmp)(e.type,t.type)}},{title:"\u670d\u52a1",dataIndex:"svc",key:"svc",width:"15%",sorter:function(e,t){return(0,X.strcmp)(e.svc||"",t.svc||"")}}];n.forEach(function(e){l(e),R.push({title:K.default.createElement("a",{onClick:function(){return y({type:"resource/updateState",payload:{rightSiderFold:!1,rightSiderNodeId:e.id}})}},K.default.createElement(E.default,{placement:"top",title:e.status},K.default.createElement(C.default,{dot:e.standby,style:{backgroundColor:"orange"}},K.default.createElement(b.default,{size:"small",icon:"desktop",style:{color:"white",backgroundColor:e.running?"green":"red"}}))),K.default.createElement("span",{className:e.id!==f||d?"":Q.default.selectedNode},"\xa0",e.id)),dataIndex:"running_node",key:e.id,width:36/n.length+"%",render:function(t,a){var n=(0,X.queryArray)(a.location,e.id,"node")||{},l=-1===t.indexOf(e.id)?"default":"success";return K.default.createElement("span",{style:{marginLeft:"10%"}},K.default.createElement(C.default,{status:l,text:n.level}))}})});var x={selectedRowKeys:i,onChange:function(e,t){y({type:"resource/updateState",payload:{selectedRowKeys:e,selectedRows:t}})},type:"radio"},w=K.default.createElement(g.default,{onClick:function(e){y({type:"resource/updateState",payload:{detailModalVisible:!0,metaAttrs:{},rsc:{category:e.key}}}),"primitive"===e.key&&y({type:"resource/queryRscTypes"}),y({type:"resource/queryRscAttrs",payload:{category:e.key}})}},K.default.createElement(g.default.Item,{key:"primitive"},"\u6dfb\u52a0\u666e\u901a\u8d44\u6e90"),K.default.createElement(g.default.Item,{key:"group"},"\u6dfb\u52a0\u7ec4\u8d44\u6e90"),K.default.createElement(g.default.Item,{key:"clone"},"\u6dfb\u52a0\u514b\u9686\u8d44\u6e90")),_=K.default.createElement(g.default,{onClick:function(e){y("location"===e.key?{type:"node/query"}:{type:"resource/query"}),y({type:"resource/queryRscRestriction",payload:{id:s[0].id,relation:e.key}}).then(function(){y({type:"resource/updateState",payload:{rscRestrictionModalVisible:!0,rscRestrictionModalTitle:e.key}})})}},K.default.createElement(g.default.Item,{key:"location"},"\u8d44\u6e90\u4f4d\u7f6e"),K.default.createElement(g.default.Item,{key:"colocation"},"\u8d44\u6e90\u534f\u540c"),K.default.createElement(g.default.Item,{key:"order"},"\u8d44\u6e90\u987a\u5e8f")),O=[{onClick:function(){"primitive"===s[0].type&&y({type:"resource/queryRscTypes"}),y({type:"resource/queryRscAttrs",payload:{category:s[0].type}}),y({type:"resource/detail",payload:{id:s[0].id.split(":")[0],category:s[0].type}}).then(function(){y({type:"resource/updateState",payload:{detailModalVisible:!0}})})},icon:"edit",text:"\u7f16\u8f91",enabled:function(){return 1===i.length&&"ms-drbd"!==s[0].id&&"drbd-ps:0"!==s[0].id&&"drbd-ps:1"!==s[0].id}},{onClick:function(){return e.handleResourceOperation(s[0].id,"start")},icon:"caret-right",text:"\u542f\u52a8",enabled:function(){var e=s;return 1===e.length&&"Running"!==e[0].status}},{onClick:function(){return e.handleResourceOperation(s[0].id,"stop")},icon:"stop",text:"\u505c\u6b62",enabled:function(){return 1===s.length}},{onClick:function(){return e.handleResourceOperation(s[0].id,"cleanup")},icon:"clear",text:"\u6e05\u7406",enabled:function(){return 1===i.length}},{onClick:function(){y({type:"resource/updateState",payload:{rscMigrationModalVisible:!0}})},icon:"export",text:"\u8fc1\u79fb",enabled:function(){var e=s;return 1===e.length&&"Running"===e[0].status&&"clone"!==e[0].type&&!e[0].isChild}},{onClick:function(){return e.handleResourceOperation(s[0].id,"unmigrate",{is_all_rscs:!1})},icon:"import",text:"\u56de\u8fc1",enabled:function(){var e=s;return 1===e.length&&"Running"===e[0].status&&"clone"!==e[0].type&&!e[0].isChild&&e[0].allow_unmigrate}}];return K.default.createElement("div",{className:(0,B.default)(Q.default.container,(0,m.default)({},Q.default.diminish,!d&&document.body.clientWidth>425))},K.default.createElement(U.Loader,{spinning:h}),K.default.createElement("div",{style:{marginBottom:0}},K.default.createElement(p.default.Group,null,K.default.createElement(c.default,{overlay:w},K.default.createElement(p.default,null,K.default.createElement(S.default,{type:"plus"}),"\u6dfb\u52a0...")),O.map(function(e){return K.default.createElement(p.default,{key:e.text,disabled:!e.enabled(),onClick:e.onClick,title:e.text},K.default.createElement(S.default,{type:e.icon}),e.text)}),K.default.createElement(u.default,{placement:"bottom",onConfirm:function(){e.handleResourceOperation(s[0].id,"delete")},title:"\u786e\u8ba4\u5220\u9664\u8d44\u6e90?"},K.default.createElement(p.default,{disabled:!(1===i.length&&!s[0].isChild),title:"\u5220\u9664"},K.default.createElement(S.default,{type:"delete"}),"\u5220\u9664")),K.default.createElement(c.default,{disabled:!(1===i.length&&"clone"!==s[0].type&&!s[0].isChild&&"ms-drbd"!==s[0].id),overlay:_},K.default.createElement(p.default,null,K.default.createElement(S.default,{type:"sharealt"}),"\u5173\u7cfb.."))),K.default.createElement(p.default,{title:"\u5237\u65b0",style:{float:document.body.clientWidth>425?"right":void 0},onClick:this.handleReFresh.bind(this)},K.default.createElement(S.default,{type:"reload"}),"\u5237\u65b0")),K.default.createElement(o.default,{columns:R,rowSelection:x,dataSource:a,scroll:{y:k},pagination:!1,onRow:function(t){return{onClick:function(){return e.handleRowClick(t)}}},locale:{emptyText:"\u6682\u65e0\u6570\u636e"}}),K.default.createElement("div",{className:(0,B.default)(Q.default.rightSider,(0,m.default)({},Q.default.rightSiderFold,d))},K.default.createElement("div",{className:Q.default.button,onClick:function(){return y({type:"resource/updateState",payload:{rightSiderFold:!0}})}},K.default.createElement(S.default,{type:"right"})),K.default.createElement(U.NodeView,null)),K.default.createElement(U.RscDetailModal,null),K.default.createElement(U.RscMigrationModal,null),K.default.createElement(U.RscRestrictions,null))}}]),t}(K.default.PureComponent);Z.propTypes={dispatch:H.default.func,rsclist:H.default.array,nodelist:H.default.array,selectedRowKeys:H.default.array,selectedRows:H.default.array,rightSiderFold:H.default.bool,loading:H.default.bool,rscOperateLoading:H.default.bool,tableHeight:H.default.number,mainLockVisible:H.default.bool};var Y=function(e){var t=e.resource,a=e.node,n=e.loading,l=e.app;return{rsclist:t.list,nodelist:a.list,selectedRowKeys:t.selectedRowKeys,selectedRows:t.selectedRows,rightSiderFold:t.rightSiderFold,rightSiderNodeId:t.rightSiderNodeId,loading:n.effects["resource/firstQuery"],rscOperateLoading:n.effects["resource/operate"],tableHeight:document.body.clientHeight-200,mainLockVisible:t.mainLockVisible,autoReFreshId:l.autoReFreshId,autoReFreshTaskId:l.autoReFreshTaskId}};t.default=(0,J.connect)(Y)(Z),e.exports=t.default},1383:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=a(3),r=n(l),i=a(5),o=n(i),s=a(8),u=n(s),d=a(6),c=n(d),f=a(7),p=n(f),y=a(0),m=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(y),h=a(121),g=n(h),v=a(22),b=n(v),k=a(72),E=n(k),R=a(122),C=n(R),x=a(150),S=n(x),w=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var l=0,n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&(a[n[l]]=e[n[l]]);return a},_=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.onConfirm=function(e){a.setVisible(!1);var t=a.props.onConfirm;t&&t.call(a,e)},a.onCancel=function(e){a.setVisible(!1);var t=a.props.onCancel;t&&t.call(a,e)},a.onVisibleChange=function(e){a.setVisible(e)},a.saveTooltip=function(e){a.tooltip=e},a.renderOverlay=function(e){var t=a.props,n=t.prefixCls,l=t.title,r=t.cancelText,i=t.okText,o=t.okType;return m.createElement("div",null,m.createElement("div",{className:n+"-inner-content"},m.createElement("div",{className:n+"-message"},m.createElement(b.default,{type:"exclamation-circle"}),m.createElement("div",{className:n+"-message-title"},l)),m.createElement("div",{className:n+"-buttons"},m.createElement(E.default,{onClick:a.onCancel,size:"small"},r||e.cancelText),m.createElement(E.default,{onClick:a.onConfirm,type:o,size:"small"},i||e.okText))))},a.state={visible:e.visible},a}return(0,p.default)(t,e),(0,u.default)(t,[{key:"componentWillReceiveProps",value:function(e){"visible"in e&&this.setState({visible:e.visible})}},{key:"getPopupDomNode",value:function(){return this.tooltip.getPopupDomNode()}},{key:"setVisible",value:function(e){var t=this.props;"visible"in t||this.setState({visible:e});var a=t.onVisibleChange;a&&a(e)}},{key:"render",value:function(){var e=this.props,t=e.prefixCls,a=e.placement,n=w(e,["prefixCls","placement"]),l=m.createElement(C.default,{componentName:"Popconfirm",defaultLocale:S.default.Popconfirm},this.renderOverlay);return m.createElement(g.default,(0,r.default)({},n,{prefixCls:t,placement:a,onVisibleChange:this.onVisibleChange,visible:this.state.visible,overlay:l,ref:this.saveTooltip}))}}]),t}(m.Component);t.default=_,_.defaultProps={prefixCls:"ant-popover",transitionName:"zoom-big",placement:"top",trigger:"click",okType:"primary"},e.exports=t.default},1384:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(3),i=l(r),o=a(10),s=l(o),u=a(5),d=l(u),c=a(8),f=l(c),p=a(6),y=l(p),m=a(7),h=l(m),g=a(0),v=n(g),b=a(13),k=n(b),E=a(22),R=l(E),C=a(9),x=l(C),S=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var l=0,n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&(a[n[l]]=e[n[l]]);return a},w=function(e){function t(e){(0,d.default)(this,t);var a=(0,y.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.setScale=function(){var e=a.avatarChildren;if(e){var t=e.offsetWidth,n=k.findDOMNode(a),l=n.getBoundingClientRect().width;l-8<t?a.setState({scale:(l-8)/t}):a.setState({scale:1})}},a.handleImgLoadError=function(){return a.setState({isImgExist:!1})},a.state={scale:1,isImgExist:!0},a}return(0,h.default)(t,e),(0,f.default)(t,[{key:"componentDidMount",value:function(){this.setScale()}},{key:"componentDidUpdate",value:function(e,t){(e.children!==this.props.children||t.scale!==this.state.scale&&1===this.state.scale||t.isImgExist!==this.state.isImgExist)&&this.setScale()}},{key:"render",value:function(){var e,t,a=this,n=this.props,l=n.prefixCls,r=n.shape,o=n.size,u=n.src,d=n.icon,c=n.className,f=S(n,["prefixCls","shape","size","src","icon","className"]),p=(0,x.default)((e={},(0,s.default)(e,l+"-lg","large"===o),(0,s.default)(e,l+"-sm","small"===o),e)),y=(0,x.default)(l,c,p,(t={},(0,s.default)(t,l+"-"+r,r),(0,s.default)(t,l+"-image",u&&this.state.isImgExist),(0,s.default)(t,l+"-icon",d),t)),m=this.props.children;if(u&&this.state.isImgExist)m=v.createElement("img",{src:u,onError:this.handleImgLoadError});else if(d)m=v.createElement(R.default,{type:d});else{var h=this.avatarChildren;if(h||1!==this.state.scale){var g={msTransform:"scale("+this.state.scale+")",WebkitTransform:"scale("+this.state.scale+")",transform:"scale("+this.state.scale+")",position:"absolute",display:"inline-block",left:"calc(50% - "+Math.round(h.offsetWidth/2)+"px)"};m=v.createElement("span",{className:l+"-string",ref:function(e){return a.avatarChildren=e},style:g},m)}else m=v.createElement("span",{className:l+"-string",ref:function(e){return a.avatarChildren=e}},m)}return v.createElement("span",(0,i.default)({},f,{className:y}),m)}}]),t}(v.Component);t.default=w,w.defaultProps={prefixCls:"ant-avatar",shape:"circle",size:"default"},e.exports=t.default},1385:function(e,t,a){"use strict";a(16),a(606),a(82)},1386:function(e,t,a){"use strict";a(16),a(1387)},1387:function(e,t){},1388:function(e,t){e.exports={"text-overflow":"_32CXV","icon-button":"_29VBV",redTwinkling:"_3VVet",twinkling:"_2_gpb",rightSider:"bxuXv",button:"n50iD",rightSiderFold:"g2qJx",container:"_2qyLv",diminish:"_2yr1x",statusLoading:"_2ZSh3",selectedNode:"_270Jy"}}});