webpackJsonp([1],{1379:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function l(e){var t=!0,n=!1;switch(e.status){case"Master":break;case"Master/Standby":n=!0;break;case"Not Running/Standby":t=!1,n=!0;break;case"Standby":n=!0;break;case"Not Running":t=!1;break;case"Running":t=!0}e.running=t,e.standby=n}function r(e){if(e.drbdStatus&&"0"!==e.drbdStatus)return"error";switch(e.status){case"Running":return"success";case"Not Running":return e.status_message?"error":"default";case"Unmanaged":return"warning";case"Failed":case"Stop Failed":return"error";case"running(Master)":case"running(Slave)":return e.status="Running","success";default:return"default"}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(611),i=a(o),s=n(1385),c=a(s),d=n(191),u=a(d),f=n(72),p=a(f),m=n(192),y=a(m),h=n(609),g=a(h),b=n(10),v=a(b),k=n(121),E=a(k),R=n(24),w=a(R),C=n(120),N=a(C),S=n(73),x=a(S),_=n(30),O=a(_),V=n(5),I=a(V),T=n(8),F=a(T),M=n(6),L=a(M),q=n(7),P=a(q);n(612),n(1386),n(289),n(82),n(290),n(610),n(151),n(103),n(74);var B=n(0),j=a(B),K=n(4),D=a(K),H=n(9),z=a(H),A=n(28),J=n(75),W=n(27),U=n(1387),X=a(U),G=function(e){function t(){return(0,I.default)(this,t),(0,L.default)(this,(t.__proto__||(0,O.default)(t)).apply(this,arguments))}return(0,P.default)(t,e),(0,F.default)(t,[{key:"componentDidUpdate",value:function(e){var t=this.props.mainLockVisible;!e.mainLockVisible&&t&&this.showMainLockView()}},{key:"handleRowClick",value:function(e){(0,this.props.dispatch)({type:"resource/updateState",payload:{selectedRowKeys:[e.key],selectedRows:[e]}})}},{key:"handleResourceOperation",value:function(e,t){(0,W.handleOperation)(this.props.dispatch,"resource",e,t)}},{key:"handleReFresh",value:function(){var e=this.props.dispatch;e({type:"resource/query"}),e({type:"node/query"}),e({type:"cluster/queryHeartBeatStatus"})}},{key:"showMainLockView",value:function(){var e=this.props,t=e.dispatch,n=e.autoReFreshId,a=e.autoReFreshTaskId;"0"!==n&&(clearInterval(a),t({type:"app/updateState",payload:{autoReFreshTaskId:0}})),x.default.warning({title:"\u96c6\u7fa4\u5904\u4e8e\u672a\u542f\u52a8\u72b6\u6001\u3002",content:j.default.createElement("div",null,j.default.createElement("p",null,"\u8bf7\u542f\u52a8\u96c6\u7fa4\u540e\u7ee7\u7eed\u64cd\u4f5c\u3002")),okText:"\u542f\u52a8",onOk:function(){return new N.default(function(e){t({type:"node/operateLocal",payload:{action:"start"}}).then(function(){setTimeout(function(){return window.location="/resource",e},2e4)})})}})}},{key:"render",value:function(){var e=this,t=this.props,n=t.rsclist,a=t.nodelist,o=t.selectedRowKeys,s=t.selectedRows,d=t.rightSiderFold,f=t.rightSiderNodeId,m=t.dispatch,h=t.loading,b=t.rscOperateLoading,k=t.tableHeight,R=[{title:"\u8d44\u6e90\u540d",dataIndex:"id",key:"id",sorter:function(e,t){return(0,W.strcmp)(e.id,t.id)}},{title:"\u72b6\u6001",dataIndex:"status",key:"status",sorter:function(e,t){return(0,W.strcmp)(e.status,t.status)},width:"10%",render:function(e,t){var n=t.status_message&&"Not Running"===e?"Failed":e,a=void 0;return t.drbdStatus&&"0"!==t.drbdStatus&&(n=t.drbdMsg),"success"===r(t)?a=j.default.createElement("span",{className:"iconfont icon-B",style:{color:"green"}}):"warning"===r(t)?a=j.default.createElement("span",{className:"iconfont icon-B",style:{color:"gold"}}):"default"===r(t)?a=j.default.createElement("span",{className:"iconfont icon-B",style:{color:"#999"}}):"error"===r(t)&&(a=t.drbdStatus&&"0"!==t.drbdStatus?j.default.createElement("span",{className:X.default.redTwinkling},j.default.createElement("i",{className:"iconfont icon-B"})):j.default.createElement("span",{className:"iconfont icon-B",style:{color:"red"}})),j.default.createElement(E.default,{placement:"right",title:n},j.default.createElement("span",{style:{marginLeft:"10%",color:"green"}},b&&s[0].id===t.id?j.default.createElement(w.default,{type:"loading",className:X.default.statusLoading}):a))}},{title:"\u8d44\u6e90\u7c7b\u578b",dataIndex:"type",key:"type",width:"15%",sorter:function(e,t){return(0,W.strcmp)(e.type,t.type)}},{title:"\u670d\u52a1",dataIndex:"svc",key:"svc",width:"15%",sorter:function(e,t){return(0,W.strcmp)(e.svc||"",t.svc||"")}}];a.forEach(function(e){l(e),R.push({title:j.default.createElement("a",{onClick:function(){return m({type:"resource/updateState",payload:{rightSiderFold:!1,rightSiderNodeId:e.id}})}},j.default.createElement(E.default,{placement:"top",title:e.status},j.default.createElement(g.default,{dot:e.standby,style:{backgroundColor:"orange"}},j.default.createElement("span",{className:"iconfont icon-host",style:(0,v.default)({color:"#fff"},"color",e.running?"green":"red")}))),j.default.createElement("span",{className:e.id!==f||d?"":X.default.selectedNode},"\xa0",e.id)),dataIndex:"running_node",key:e.id,width:36/a.length+"%",render:function(t,n){var a=(0,W.queryArray)(n.location,e.id,"node")||{},l=-1===t.indexOf(e.id)?"default":"success",r="success"===l?j.default.createElement("span",null,j.default.createElement("i",{className:"iconfont icon-B",style:{color:"green"}}),j.default.createElement("span",{style:{color:"green"}},a.level)):j.default.createElement("span",null,j.default.createElement("i",{className:"iconfont icon-B",style:{color:"#999"}}),j.default.createElement("span",null,a.level));return j.default.createElement("span",{style:{marginLeft:"10%"}},r)}})});var C={selectedRowKeys:o,onChange:function(e,t){m({type:"resource/updateState",payload:{selectedRowKeys:e,selectedRows:t}})},type:"radio"},N=j.default.createElement(y.default,{onClick:function(e){m({type:"resource/updateState",payload:{detailModalVisible:!0,metaAttrs:{},rsc:{category:e.key}}}),"primitive"===e.key&&m({type:"resource/queryRscTypes"}),m({type:"resource/queryRscAttrs",payload:{category:e.key}})}},j.default.createElement(y.default.Item,{key:"primitive"},"\u6dfb\u52a0\u666e\u901a\u8d44\u6e90"),j.default.createElement(y.default.Item,{key:"group"},"\u6dfb\u52a0\u7ec4\u8d44\u6e90"),j.default.createElement(y.default.Item,{key:"clone"},"\u6dfb\u52a0\u514b\u9686\u8d44\u6e90")),S=j.default.createElement(y.default,{onClick:function(e){m("location"===e.key?{type:"node/query"}:{type:"resource/query"}),m({type:"resource/queryRscRestriction",payload:{id:s[0].id,relation:e.key}}).then(function(){m({type:"resource/updateState",payload:{rscRestrictionModalVisible:!0,rscRestrictionModalTitle:e.key}})})}},j.default.createElement(y.default.Item,{key:"location"},"\u8d44\u6e90\u4f4d\u7f6e"),j.default.createElement(y.default.Item,{key:"colocation"},"\u8d44\u6e90\u534f\u540c"),j.default.createElement(y.default.Item,{key:"order"},"\u8d44\u6e90\u987a\u5e8f")),x=[{onClick:function(){"primitive"===s[0].type&&m({type:"resource/queryRscTypes"}),m({type:"resource/queryRscAttrs",payload:{category:s[0].type}}),m({type:"resource/detail",payload:{id:s[0].id.split(":")[0],category:s[0].type}}).then(function(){m({type:"resource/updateState",payload:{detailModalVisible:!0}})})},icon:"iconfont icon-bianji2",text:"\u7f16\u8f91",enabled:function(){return 1===o.length&&"ms-drbd"!==s[0].id&&"drbd-ps:0"!==s[0].id&&"drbd-ps:1"!==s[0].id}},{onClick:function(){return e.handleResourceOperation(s[0].id,"start")},icon:"iconfont icon-kaishi",text:"\u542f\u52a8",enabled:function(){var e=s;return 1===e.length&&"Running"!==e[0].status}},{onClick:function(){return e.handleResourceOperation(s[0].id,"stop")},icon:"iconfont icon-tingzhi1",text:"\u505c\u6b62",enabled:function(){return 1===s.length}},{onClick:function(){return e.handleResourceOperation(s[0].id,"cleanup")},icon:"iconfont icon-yijianqingli",text:"\u6e05\u7406",enabled:function(){return 1===o.length}},{onClick:function(){m({type:"resource/updateState",payload:{rscMigrationModalVisible:!0}})},icon:"iconfont icon-qianchu",text:"\u8fc1\u79fb",enabled:function(){var e=s;return 1===e.length&&"Running"===e[0].status&&"clone"!==e[0].type&&!e[0].isChild}},{onClick:function(){return e.handleResourceOperation(s[0].id,"unmigrate",{is_all_rscs:!1})},icon:"iconfont icon-qianru",text:"\u56de\u8fc1",enabled:function(){var e=s;return 1===e.length&&"Running"===e[0].status&&"clone"!==e[0].type&&!e[0].isChild&&e[0].allow_unmigrate}}];return j.default.createElement("div",{className:(0,z.default)(X.default.container,(0,v.default)({},X.default.diminish,!d&&document.body.clientWidth>425))},j.default.createElement(J.Loader,{spinning:h}),j.default.createElement("div",{style:{backgroundColor:"#fff",padding:15,paddingBottom:5,borderBottom:"1px solid #e4e4e4"}},j.default.createElement(p.default.Group,null,j.default.createElement(u.default,{overlay:N},j.default.createElement(p.default,{className:X.default.operations},j.default.createElement("span",{className:"iconfont icon-icon-test"}),"\u6dfb\u52a0...")),x.map(function(e){return j.default.createElement(p.default,{key:e.text,className:X.default.operations,disabled:!e.enabled(),onClick:e.onClick,title:e.text},j.default.createElement("span",{className:e.icon}),e.text)}),j.default.createElement(c.default,{placement:"bottom",onConfirm:function(){e.handleResourceOperation(s[0].id,"delete")},title:"\u786e\u8ba4\u5220\u9664\u8d44\u6e90?"},j.default.createElement(p.default,{disabled:!(1===o.length&&!s[0].isChild),title:"\u5220\u9664",className:X.default.operations},j.default.createElement("span",{className:"iconfont icon-shanchukai"}),"\u5220\u9664")),j.default.createElement(u.default,{disabled:!(1===o.length&&"clone"!==s[0].type&&!s[0].isChild&&"ms-drbd"!==s[0].id),overlay:S},j.default.createElement(p.default,{className:X.default.operations},j.default.createElement("span",{className:"iconfont icon-guanxitu"}),"\u5173\u7cfb..")),j.default.createElement(p.default,{title:"\u5237\u65b0",style:{float:document.body.clientWidth>425?"right":"none"},className:X.default.operations,onClick:this.handleReFresh.bind(this)},j.default.createElement("span",{className:"iconfont icon-shuaxin"}),"\u5237\u65b0"))),j.default.createElement(i.default,{columns:R,rowSelection:C,dataSource:n,scroll:{y:k},pagination:!1,onRow:function(t){return{onClick:function(){return e.handleRowClick(t)}}},locale:{emptyText:"\u6682\u65e0\u6570\u636e"}}),j.default.createElement("div",{className:(0,z.default)(X.default.rightSider,(0,v.default)({},X.default.rightSiderFold,d))},j.default.createElement("div",{className:X.default.button,onClick:function(){return m({type:"resource/updateState",payload:{rightSiderFold:!0}})}},j.default.createElement(w.default,{type:"right"})),j.default.createElement(J.NodeView,null)),j.default.createElement(J.RscDetailModal,null),j.default.createElement(J.RscMigrationModal,null),j.default.createElement(J.RscRestrictions,null))}}]),t}(j.default.PureComponent);G.propTypes={dispatch:D.default.func,rsclist:D.default.array,nodelist:D.default.array,selectedRowKeys:D.default.array,selectedRows:D.default.array,rightSiderFold:D.default.bool,loading:D.default.bool,rscOperateLoading:D.default.bool,tableHeight:D.default.number,mainLockVisible:D.default.bool};var Q=function(e){var t=e.resource,n=e.node,a=e.loading,l=e.app;return{rsclist:t.list,nodelist:n.list,selectedRowKeys:t.selectedRowKeys,selectedRows:t.selectedRows,rightSiderFold:t.rightSiderFold,rightSiderNodeId:t.rightSiderNodeId,loading:a.effects["resource/firstQuery"],rscOperateLoading:a.effects["resource/operate"],tableHeight:document.body.clientHeight-200,mainLockVisible:t.mainLockVisible,autoReFreshId:l.autoReFreshId,autoReFreshTaskId:l.autoReFreshTaskId}};t.default=(0,A.connect)(Q)(G),e.exports=t.default},1385:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=n(3),r=a(l),o=n(5),i=a(o),s=n(8),c=a(s),d=n(6),u=a(d),f=n(7),p=a(f),m=n(0),y=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(m),h=n(121),g=a(h),b=n(24),v=a(b),k=n(72),E=a(k),R=n(122),w=a(R),C=n(150),N=a(C),S=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var l=0,a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&(n[a[l]]=e[a[l]]);return n},x=function(e){function t(e){(0,i.default)(this,t);var n=(0,u.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onConfirm=function(e){n.setVisible(!1);var t=n.props.onConfirm;t&&t.call(n,e)},n.onCancel=function(e){n.setVisible(!1);var t=n.props.onCancel;t&&t.call(n,e)},n.onVisibleChange=function(e){n.setVisible(e)},n.saveTooltip=function(e){n.tooltip=e},n.renderOverlay=function(e){var t=n.props,a=t.prefixCls,l=t.title,r=t.cancelText,o=t.okText,i=t.okType;return y.createElement("div",null,y.createElement("div",{className:a+"-inner-content"},y.createElement("div",{className:a+"-message"},y.createElement(v.default,{type:"exclamation-circle"}),y.createElement("div",{className:a+"-message-title"},l)),y.createElement("div",{className:a+"-buttons"},y.createElement(E.default,{onClick:n.onCancel,size:"small"},r||e.cancelText),y.createElement(E.default,{onClick:n.onConfirm,type:i,size:"small"},o||e.okText))))},n.state={visible:e.visible},n}return(0,p.default)(t,e),(0,c.default)(t,[{key:"componentWillReceiveProps",value:function(e){"visible"in e&&this.setState({visible:e.visible})}},{key:"getPopupDomNode",value:function(){return this.tooltip.getPopupDomNode()}},{key:"setVisible",value:function(e){var t=this.props;"visible"in t||this.setState({visible:e});var n=t.onVisibleChange;n&&n(e)}},{key:"render",value:function(){var e=this.props,t=e.prefixCls,n=e.placement,a=S(e,["prefixCls","placement"]),l=y.createElement(w.default,{componentName:"Popconfirm",defaultLocale:N.default.Popconfirm},this.renderOverlay);return y.createElement(g.default,(0,r.default)({},a,{prefixCls:t,placement:n,onVisibleChange:this.onVisibleChange,visible:this.state.visible,overlay:l,ref:this.saveTooltip}))}}]),t}(y.Component);t.default=x,x.defaultProps={prefixCls:"ant-popover",transitionName:"zoom-big",placement:"top",trigger:"click",okType:"primary"},e.exports=t.default},1386:function(e,t,n){"use strict";n(16),n(608),n(82)},1387:function(e,t){e.exports={"text-overflow":"_32CXV","icon-button":"_29VBV",redTwinkling:"_3VVet",twinkling:"_2_gpb",rightSider:"bxuXv",button:"n50iD",rightSiderFold:"g2qJx",container:"_2qyLv",diminish:"_2yr1x",selectedNode:"_270Jy",operations:"_3r3a-"}}});